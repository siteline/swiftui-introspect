default_platform(:ios)
skip_docs

platform :ios do
    lane :test do |options|
        ci = ENV['CI']
        puts 'Running on CI.' if ci

        devices = case (options[:version] || 13).to_i
        when 13
            [
                "iPhone 11 Pro (13.7)",
                "iPad Pro (11-inch) (2nd generation) (13.7)",
                "Apple TV (13.7)",
            ]
        when 14
            [
                "iPhone 11 Pro (14.5)",
                "iPad Pro (11-inch) (3rd generation) (14.5)",
                "Apple TV (14.5)",
            ]
        when 15
            [
                "iPhone 11 Pro (15.5)",
                "iPad Pro (11-inch) (3rd generation) (15.5)",
                "Apple TV (15.5)",
            ]
        when 16
            [
                "iPhone 14 Pro (16.2)",
                "iPad Pro (11-inch) (4th generation) (16.2)",
                "Apple TV (16.2)",
            ]
        else
            puts "Unsupported iOS version: #{ios}"
            exit 1
        end

        run_tests(
            devices: devices,
            ensure_devices_found: true,
            scheme: "Introspect",
            # skip_build: ci,
        )
    end
end

platform :mac do
    lane :test do |options|
        puts 'Running on GitHub CI.' if options[:ci] == 'github'
        scan(
            scheme: "Introspect macOS",
            skip_build: options[:ci] == 'github'
        )
    end
end
